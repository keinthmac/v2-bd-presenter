"use strict";(self.webpackChunkfuse=self.webpackChunkfuse||[]).push([[596],{5596:(_,u,n)=>{n.r(u),n.d(u,{AppPatchModule:()=>q});var d=n(4755),f=n(9223),g=n(3144),s=n(9401),Z=n(8746),t=n(2223),A=n(2340),N=n(262),P=n(2843),w=n(3900),S=n(9646);let T=(()=>{class e{constructor(o){this._httpClient=o,this.apiHost=A.N.apiHost}set accessToken(o){sessionStorage.removeItem("access_token"),sessionStorage.setItem("access_token",o)}get accessToken(){return sessionStorage.getItem("access_token")??""}Upload(o){return this._httpClient.post(`${this.apiHost}patch/add`,o,{reportProgress:!0,observe:"events"}).pipe((0,N.K)(i=>(0,P._)(i)),(0,w.w)(i=>(0,S.of)(i)))}}return e.\u0275fac=function(o){return new(o||e)(t.LFG(g.eN))},e.\u0275prov=t.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var h=n(7433),v=n(430),x=n(6699),l=n(5741),y=n(6718),p=n(7662);function F(e,a){1&e&&(t.TgZ(0,"span",31),t._uU(1,"We are now saving your files to our server."),t.qZA())}function I(e,a){if(1&e&&t._UZ(0,"mat-progress-bar",32),2&e){const o=t.oxw(2);t.Q6J("value",o.uploadProgress)("mode","determinate")}}function C(e,a){1&e&&t._UZ(0,"mat-progress-bar",33),2&e&&t.Q6J("mode","indeterminate")}function b(e,a){if(1&e&&(t.ynx(0),t.TgZ(1,"span",25),t._uU(2,"Please wait while we submit your patch."),t.qZA(),t.TgZ(3,"span",26)(4,"span",27),t._uU(5,"DO NOT"),t.qZA(),t._uU(6," refresh or close this browser, or even switch to other app until we finish everything."),t.qZA(),t.YNc(7,F,2,0,"span",28),t.YNc(8,I,1,2,"mat-progress-bar",29),t.YNc(9,C,1,1,"mat-progress-bar",30),t.BQk()),2&e){const o=t.oxw();t.xp6(7),t.Q6J("ngIf",o.savinginProgress),t.xp6(1),t.Q6J("ngIf",!o.savinginProgress),t.xp6(1),t.Q6J("ngIf",o.savinginProgress)}}function z(e,a){1&e&&(t.TgZ(0,"span",38),t._uU(1,"Submit"),t.qZA())}function U(e,a){if(1&e){const o=t.EpF();t.TgZ(0,"div",34)(1,"button",35),t.NdJ("click",function(){t.CHM(o);const r=t.oxw();return t.KtG(r.submit())}),t.TgZ(2,"div"),t.YNc(3,z,2,0,"span",36),t.TgZ(4,"span",37),t._uU(5,"Submit"),t.qZA()()()()}if(2&e){const o=t.oxw();t.xp6(1),t.Q6J("color","primary")("disabled",!o.patchFormGroup.valid),t.xp6(2),t.Q6J("ngIf",o.patchFormGroup.valid)}}const J=function(e){return{"text-blue-700":e}},j=[{path:"",data:{layout:"empty"},children:[{path:"add",data:{layout:"centered"},component:(()=>{class e{constructor(o,i){this._formBuilder=o,this._patchService=i,this.uploadProgress=0,this.savinginProgress=!1,this.isSubmitting=!1}ngOnInit(){this.patchFormGroup=this._formBuilder.group({versionNo:[null,s.kI.compose([s.kI.required])],releaseNotes:[null,s.kI.compose([s.kI.required])],persistDb:["true",s.kI.compose([s.kI.required])],valid:[null,s.kI.compose([s.kI.required])]})}onFileSelected(o){this.fileSelected=o.target.files[0],new FileReader,this.totalFileSize=this.fileSelected?.size,this.calculateFileSize()}submit(){this.isSubmitting=!0;const o=new FormData;o.append("versionNo",this.patchFormGroup.get("versionNo").value),o.append("isPersistDb",this.patchFormGroup.get("persistDb").value),o.append("releaseNotes",this.patchFormGroup.get("releaseNotes").value),o.append("files",this.fileSelected),this._patchService.Upload(o).pipe((0,Z.x)(()=>{this.uploadProgress=0,this.savinginProgress=!1,this.isSubmitting=!1})).subscribe(r=>{if(r.type==g.dt.UploadProgress){const c=Math.round(r.loaded/r.total*100);this.uploadProgress=c,c>=100&&(this.savinginProgress=!0)}},r=>{})}calculateFileSize(){isNaN(this.totalFileSize)&&(this.totalFileSize=0);let o="KB",i=0,r=this.totalFileSize/1024;r/1024>1?(i=r/1024,o="MB"):(i=r,o="KB"),this.totalFileSize>0?this.patchFormGroup.get("valid").setValue(!0):this.patchFormGroup.get("valid").setValue(null),this.totalFileSizeString=`${(i||0).toFixed(2)} ${o}`}}return e.\u0275fac=function(o){return new(o||e)(t.Y36(s.QS),t.Y36(T))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-add-new-patch"]],decls:41,vars:9,consts:[[1,"flex","flex-col","items-center","justify-center","flex-auto","p-4"],[1,"flex","items-center","justify-end","w-full","sm:w-auto","p-2","rounded-2xl","shadow-lg","sm:bg-card","max-w-[1000px]","md:min-w-[580px]"],[1,"w-full","p-2","sm:mx-0"],[1,"flex","flex-col","items-center","justify-center","mt-2","font-medium"],[1,"text-center"],[3,"formGroup"],["appearance","fill",1,"w-full","mt-4"],["required","","matInput","","placeholder","Release notes","type","text","formControlName","releaseNotes","required",""],["required","","matInput","","placeholder","Version number","type","text","inputmode","decimal","formControlName","versionNo","required",""],["mat-icon-button","","type","button","matSuffix","",3,"click"],[1,"icon-size-5",3,"svgIcon"],[1,"flex","flex-row","justify-center"],["required","","formControlName","persistDb"],["value","false",1,"mr-6"],["value","true",1,"mr-6"],["hidden","","type","file","accept",".zip",3,"change"],["selectFile",""],[1,"mt-4","flex","flex-row","justify-center"],[1,"flex","flex-col","justify-center"],[1,"flex-row","justify-center","icon-size-20","text-gray-200",3,"ngClass","svgIcon"],[1,"flex","flex-col","justify-center","w-[150px]","h-[30px]","rounded-lg","shadow-lg","cursor-pointer","bg-purple-700","hover:bg-purple-500","hover:shadow-xl",3,"click"],[1,"text-white","text-md","text-center","w-full"],[1,"relative","flex","flex-col","left-0","z-49","mt-2"],[4,"ngIf"],["class","mt-2 flex flex-row items-end justify-end",4,"ngIf"],[1,"text-start","font-medium","text-md","mt-2","break-words","whitespace-pre-line"],[1,"text-start","font-medium","text-md","mt-4","break-words","whitespace-pre-line","text-red-600"],[1,"p-[5px]","text-white","bg-red-500","font-semibold"],["class","mt-2 text-start font-medium text-md break-words whitespace-pre-line text-green-500",4,"ngIf"],["class","mt-2 w-full h-[10px]",3,"value","mode",4,"ngIf"],["class","mt-2 w-full h-[10px]",3,"mode",4,"ngIf"],[1,"mt-2","text-start","font-medium","text-md","break-words","whitespace-pre-line","text-green-500"],[1,"mt-2","w-full","h-[10px]",3,"value","mode"],[1,"mt-2","w-full","h-[10px]",3,"mode"],[1,"mt-2","flex","flex-row","items-end","justify-end"],["mat-flat-button","",3,"color","disabled","click"],["class","absolute inline-flex animate-ping text-white",4,"ngIf"],[1,"relative","inline-flex","text-white"],[1,"absolute","inline-flex","animate-ping","text-white"]],template:function(o,i){if(1&o){const r=t.EpF();t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4),t._uU(5,"Please fill the following information."),t.qZA()(),t.TgZ(6,"form",5)(7,"mat-form-field",6)(8,"mat-label"),t._uU(9,"Release Notes"),t.qZA(),t._UZ(10,"textarea",7),t.TgZ(11,"mat-error"),t._uU(12," Release notes is required. "),t.qZA()(),t.TgZ(13,"mat-form-field",6)(14,"mat-label"),t._uU(15,"Version"),t.qZA(),t._UZ(16,"input",8),t.TgZ(17,"button",9),t.NdJ("click",function(){return i.patchFormGroup.get("versionNo").setValue("")}),t._UZ(18,"mat-icon",10),t.qZA(),t.TgZ(19,"mat-error"),t._uU(20," Version is required. "),t.qZA()(),t.TgZ(21,"div",11)(22,"mat-radio-group",12)(23,"mat-radio-button",13),t._uU(24,"Delete Database"),t.qZA(),t.TgZ(25,"mat-radio-button",14),t._uU(26,"Persist Database"),t.qZA()()(),t.TgZ(27,"input",15,16),t.NdJ("change",function(m){return i.onFileSelected(m)}),t.qZA(),t.TgZ(29,"div",17)(30,"div",18),t._UZ(31,"mat-icon",19),t.TgZ(32,"span",4),t._uU(33),t.qZA()()(),t.TgZ(34,"div",17)(35,"button",20),t.NdJ("click",function(){t.CHM(r);const m=t.MAs(28);return t.KtG(m.click())}),t.TgZ(36,"span",21),t._uU(37,"Select patch (.zip)"),t.qZA()()(),t.TgZ(38,"div",22),t.YNc(39,b,10,3,"ng-container",23),t.qZA(),t.YNc(40,U,6,3,"div",24),t.qZA()()()()}2&o&&(t.xp6(6),t.Q6J("formGroup",i.patchFormGroup),t.xp6(12),t.Q6J("svgIcon","heroicons_solid:x-circle"),t.xp6(13),t.Q6J("ngClass",t.VKq(7,J,i.totalFileSize>0))("svgIcon","heroicons_solid:cube"),t.xp6(2),t.Oqu(i.totalFileSizeString),t.xp6(6),t.Q6J("ngIf",i.isSubmitting),t.xp6(1),t.Q6J("ngIf",!i.isSubmitting))},dependencies:[d.mk,d.O5,h.eB,v.Hw,x.eI,s._Y,s.Fj,s.JJ,s.JL,s.Q7,s.sg,s.u,l.nI,l.v_,l.$V,l.nX,y.k0,p.OY,p.vy]}),e})()}]}];let G=(()=>{class e{}return e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[f.Bz.forChild(j),f.Bz]}),e})();var Q=n(8492),M=n(9570),D=n(3314),Y=n(8927),B=n(8280),V=n(4387),K=n(3630),R=n(5815),H=n(5775),O=n(7961),$=n(1644),E=n(7469),k=n(6287),X=n(332),L=n(7775),W=n(4466);let q=(()=>{class e{}return e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[d.ez,G,d.ez,h.yu,D.vV,K.t,v.Ps,H.jT,x.jc,W.m,l.wp,V.yj,y.x4,E.Wd,Y.yD,M.D8,O.UK,k.y,L.fC,X.T5,B.FA,Q.Yd,$.uw,p.Xo,R.N6]}),e})()}}]);